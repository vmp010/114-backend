{
	"info": {
		"_postman_id": "114-backend-oauth-demo",
		"name": "114-Backend Google OAuth Demo",
		"description": "# Google OAuth æ•™å­¸ç¯„ä¾‹\n\né€™å€‹ Collection åŒ…å«å…©ç¨® OAuth æ¶æ§‹çš„å¯¦ä½œï¼š\n\n## æ¶æ§‹ A: Authorization Code Flow\n- å‰ç«¯åªå‚³ `code`ï¼Œå¾Œç«¯ç”¨ `code + client_secret` æ› token\n- **è¼ƒå®‰å…¨**ï¼Œå› ç‚º `client_secret` æ°¸é ä¸æœƒæš´éœ²åœ¨å‰ç«¯\n- é©åˆæœ‰å¾Œç«¯çš„ç¶²ç«™\n\n## æ¶æ§‹ B: Google Sign-In SDK Flow\n- å‰ç«¯ç”¨ Google SDK ç›´æ¥æ‹¿åˆ° `id_token`\n- **è¼ƒç°¡å–®**ï¼Œä¸éœ€è¦å¾Œç«¯è™•ç†æ› token çš„é‚è¼¯\n- é©åˆç´”å‰ç«¯æ‡‰ç”¨æˆ–å¿«é€Ÿé–‹ç™¼\n\n---\n\n## æ¸¬è©¦æ­¥é©Ÿ\n\n### ä½¿ç”¨ OAuth Playground å–å¾— tokens\n1. é–‹å•Ÿ [Google OAuth Playground](https://developers.google.com/oauthplayground)\n2. é»å³ä¸Šè§’é½’è¼ª âš™ï¸ï¼Œå‹¾é¸ã€ŒUse your own OAuth credentialsã€\n3. å¡«å…¥ Client ID å’Œ Client Secret\n4. å·¦å´ Input your own scopes è¼¸å…¥ï¼š`openid email profile`\n5. é»ã€ŒAuthorize APIsã€â†’ ç™»å…¥ Google\n6. **æ¶æ§‹ A**ï¼šåœ¨ Step 2 ä¹‹å‰ï¼Œå¾ URL è¤‡è£½ `code` åƒæ•¸\n7. **æ¶æ§‹ B**ï¼šé»ã€ŒExchange authorization code for tokensã€ï¼Œè¤‡è£½ `id_token`",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "0. æ¸¬è©¦ä¼ºæœå™¨é€£ç·š",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/",
					"host": ["{{base_url}}"],
					"path": [""]
				},
				"description": "æ¸¬è©¦ä¼ºæœå™¨æ˜¯å¦æ­£å¸¸é‹ä½œã€‚"
			},
			"response": []
		},
		{
			"name": "æ¶æ§‹ A - Authorization Code Flow",
			"description": "## æ¶æ§‹ A: Authorization Code Flow\n\n```\nå‰ç«¯ â†’ å°å‘ Google â†’ æ‹¿åˆ° code â†’ å‚³çµ¦å¾Œç«¯\nå¾Œç«¯ â†’ ç”¨ code + secret æ› tokens â†’ é©—è­‰ â†’ ç™¼ JWT\n```\n\n### å®‰å…¨æ€§\n- âœ… client_secret åªå­˜åœ¨å¾Œç«¯\n- âœ… å‰ç«¯æ°¸é ä¸çŸ¥é“ secret\n- âœ… è¼ƒå®‰å…¨çš„åšæ³•",
			"item": [
				{
					"name": "1A. ç”¨ Code æ›å– JWT",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"âœ… access_token å·²è‡ªå‹•å„²å­˜ï¼\");",
									"    console.log(\"ä½¿ç”¨è€…ï¼š\" + jsonData.user.email);",
									"}",
									"",
									"pm.test(\"ç™»å…¥æˆåŠŸï¼Œå›å‚³ access_token\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"    pm.expect(jsonData).to.have.property('user');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"code\": \"{{google_auth_code}}\",\n    \"redirect_uri\": \"https://developers.google.com/oauthplayground\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/google/code",
							"host": ["{{base_url}}"],
							"path": ["auth", "google", "code"]
						},
						"description": "## [æ¶æ§‹ A] ç”¨ Authorization Code æ›å– JWT\n\n### å¦‚ä½•å–å¾— codeï¼Ÿ\n1. åœ¨ OAuth Playground å®Œæˆ Step 1 (Authorize APIs) å¾Œ\n2. çœ‹ç€è¦½å™¨ç¶²å€åˆ—ï¼Œæœƒæœ‰ `?code=4/0ATx...` çš„åƒæ•¸\n3. è¤‡è£½ `code` çš„å€¼ï¼ˆéœ€è¦ URL decodeï¼‰\n\n### è«‹æ±‚æ ¼å¼\n```json\n{\n    \"code\": \"4/0ATx87lO...\",\n    \"redirect_uri\": \"https://developers.google.com/oauthplayground\"\n}\n```\n\n### å¾Œç«¯åšäº†ä»€éº¼ï¼Ÿ\n1. æ”¶åˆ° code\n2. ç”¨ code + client_secret å‘ Google æ› tokens\n3. é©—è­‰ id_token\n4. ç™¼æ”¾è‡ªå®¶ JWT\n\nâš ï¸ **æ³¨æ„**ï¼šcode åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä¸”å¹¾åˆ†é˜å…§æœƒéæœŸï¼"
					},
					"response": [
						{
							"name": "ç™»å…¥æˆåŠŸ",
							"status": "OK",
							"code": 200,
							"body": "{\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"token_type\": \"bearer\",\n    \"user\": {\n        \"name\": \"Test User\",\n        \"email\": \"test@gmail.com\",\n        \"picture\": \"https://...\"\n    },\n    \"google_access_token\": \"ya29.a0AfB_by...\"\n}"
						},
						{
							"name": "Code ç„¡æ•ˆæˆ–å·²éæœŸ",
							"status": "Unauthorized",
							"code": 401,
							"body": "{\n    \"detail\": \"ç„¡æ³•æ›å– Token: invalid_grant\"\n}"
						}
					]
				}
			]
		},
		{
			"name": "æ¶æ§‹ B - Google Sign-In SDK Flow",
			"description": "## æ¶æ§‹ B: Google Sign-In SDK Flow\n\n```\nå‰ç«¯ â†’ ç”¨ Google SDK ç™»å…¥ â†’ ç›´æ¥æ‹¿åˆ° id_token â†’ å‚³çµ¦å¾Œç«¯\nå¾Œç«¯ â†’ é©—è­‰ id_token â†’ ç™¼ JWT\n```\n\n### ç‰¹é»\n- âœ… å¯¦ä½œç°¡å–®ï¼Œå‰ç«¯ç”¨ SDK å°±å¥½\n- âœ… ä¸éœ€è¦è™•ç† code äº¤æ›é‚è¼¯\n- âš ï¸ åªèƒ½æ‹¿åˆ° id_tokenï¼Œç„¡æ³•å‘¼å« Google API",
			"item": [
				{
					"name": "1B. ç”¨ ID Token æ›å– JWT",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"âœ… access_token å·²è‡ªå‹•å„²å­˜ï¼\");",
									"    console.log(\"ä½¿ç”¨è€…ï¼š\" + jsonData.user.email);",
									"}",
									"",
									"pm.test(\"ç™»å…¥æˆåŠŸï¼Œå›å‚³ access_token\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"    pm.expect(jsonData).to.have.property('user');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"id_token\": \"{{google_id_token}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/google",
							"host": ["{{base_url}}"],
							"path": ["auth", "google"]
						},
						"description": "## [æ¶æ§‹ B] ç”¨ Google ID Token æ›å– JWT\n\n### å¦‚ä½•å–å¾— id_tokenï¼Ÿ\n1. åœ¨ OAuth Playground å®Œæˆ Step 1 & 2\n2. è¤‡è£½å›æ‡‰ä¸­çš„ `id_token`\n\n### è«‹æ±‚æ ¼å¼\n```json\n{\n    \"id_token\": \"eyJhbGciOiJSUzI1NiIs...\"\n}\n```\n\n### å¾Œç«¯åšäº†ä»€éº¼ï¼Ÿ\n1. æ”¶åˆ° id_token\n2. å‘ Google é©—è­‰ id_token æ˜¯å¦åˆæ³•\n3. ç™¼æ”¾è‡ªå®¶ JWT\n\nğŸ’¡ é€™ç¨®æ–¹å¼ä¸éœ€è¦ client_secretï¼Œå› ç‚ºæ²’æœ‰ã€Œæ› tokenã€é€™ä¸€æ­¥"
					},
					"response": [
						{
							"name": "ç™»å…¥æˆåŠŸ",
							"status": "OK",
							"code": 200,
							"body": "{\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"token_type\": \"bearer\",\n    \"user\": {\n        \"name\": \"Test User\",\n        \"email\": \"test@gmail.com\",\n        \"picture\": \"https://...\"\n    }\n}"
						},
						{
							"name": "Token ç„¡æ•ˆ",
							"status": "Unauthorized",
							"code": 401,
							"body": "{\n    \"detail\": \"ç„¡æ•ˆçš„ Google Token\"\n}"
						}
					]
				}
			]
		},
		{
			"name": "2. å–å¾—ç•¶å‰ä½¿ç”¨è€…ï¼ˆéœ€ JWTï¼‰",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"æˆåŠŸå–å¾—ä½¿ç”¨è€…è³‡è¨Š\", function () {",
							"    pm.response.to.have.status(200);",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('user_email');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/users/me",
					"host": ["{{base_url}}"],
					"path": ["users", "me"]
				},
				"description": "## å—ä¿è­·çš„è·¯ç”±\n\nä¸è«–ä½¿ç”¨æ¶æ§‹ A æˆ– B ç™»å…¥ï¼Œæ‹¿åˆ°çš„ JWT éƒ½å¯ä»¥ç”¨ä¾†å­˜å–é€™å€‹è·¯ç”±ã€‚\n\n### Header\n```\nAuthorization: Bearer <jwt_token>\n```"
			},
			"response": []
		},
		{
			"name": "3. æŸ¥çœ‹ API æ–‡ä»¶",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/docs",
					"host": ["{{base_url}}"],
					"path": ["docs"]
				},
				"description": "é–‹å•Ÿ FastAPI Swagger UI\n\nğŸ’¡ å»ºè­°ç›´æ¥åœ¨ç€è¦½å™¨é–‹å•Ÿï¼šhttp://localhost:8000/docs"
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [""]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test(\"å›æ‡‰æ™‚é–“å°æ–¼ 2 ç§’\", function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(2000);",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "google_auth_code",
			"value": "åœ¨é€™è£¡è²¼ä¸Šå¾ OAuth Playground URL å–å¾—çš„ code",
			"type": "string"
		},
		{
			"key": "google_id_token",
			"value": "åœ¨é€™è£¡è²¼ä¸Šå¾ OAuth Playground å–å¾—çš„ id_token",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "google_client_id",
			"value": "YOUR_GOOGLE_CLIENT_ID",
			"type": "string"
		},
		{
			"key": "google_client_secret",
			"value": "YOUR_GOOGLE_CLIENT_SECRET",
			"type": "string"
		}
	]
}
